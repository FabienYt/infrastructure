#jinja2: trim_blocks: "true", lstrip_blocks: "true"
---
{{ ansible_managed | comment }}
# Generated by Ansible role {{ ansible_role_name }}

http:
  middlewares:
    compress:
      compress: {}
    securedheaders:
      headers:
        forceSTSHeader: true
        sslRedirect: true
        stsPreload: true
        contentTypeNosniff: true
        browserXssFilter: true
        stsIncludeSubdomains: true
        stsSeconds: 315360000
    floc:
      headers:
        customResponseHeaders:
          Permissions-Policy: interest-cohort=()
{% if traefik_reverse_proxy is defined %}
  routers:
    {% for service in traefik_reverse_proxy %}
    to-{{ service.name }}:
      rule: "Host(`{{ service.domain }}`)"
      service: {{ service.name }}@file
      entryPoints:
        - websecure
    {% endfor %}
  services:
    {% for service in traefik_reverse_proxy %}
    {{ service.name }}:
      loadBalancer:
        passHostHeader: true
        servers:
          - url: "{{ service.destination }}"
    {% endfor %}
{% endif %}

tls:
  options:
    default:
      minVersion: VersionTLS12
      cipherSuites:
        - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
        - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
        - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
        - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
        - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
      curvePreferences:
        - secp521r1
        - secp384r1
      sniStrict: true
